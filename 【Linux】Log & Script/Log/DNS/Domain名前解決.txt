[root@deploy ~]# 
[root@deploy ~]# date
2023年  3月 12日 日曜日 05:18:23 JST
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# uname -r
3.10.0-1160.el7.x86_64
[root@deploy ~]# 
[root@deploy ~]# hostname
hogehoge.co.jp
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# hostname -d
co.jp
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# hostname -f
hogehoge.co.jp
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# mkdir -p /var/www/html/hogehoge.co.jp/index.html
[root@deploy ~]# 
[root@deploy ~]# echo ‘ドメインの設定が完了！’ > /var/www/html/hogehoge.co.jp/index.html
[root@deploy ~]# 
[root@deploy ~]# vi /etc/httpd/conf/httpd.conf  # 以下を追加
---------------------------------------------------------------------------------------

    359 
    360 <VirtualHost 192.168.3.11:80>
    361 
    362   ServerName hogehoge.co.jp
    363 
    364   DocumentRoot “/var/www/hogehoge.co.jp/index.html”
    365 
    366   DirectoryIndex index.html index.php
    367 
    368   ErrorLog /var/log/httpd/domain-name.com_error_log
    369 
    370   CustomLog /var/log/httpd/ddomain-name.com_access_log combined
    371 
    372   AddDefaultCharset UTF-8
    373 
    374 </VirtualHost>
 
---------------------------------------------------------------------------------------
[root@deploy ~]# 
[root@deploy ~]# systemctl restart httpd.service
[root@deploy ~]# 
[root@deploy ~]# service httpd configtest
AH00112: Warning: DocumentRoot [/etc/httpd/\xe2\x80\x9c/var/www/hogehoge.co.jp/public_html\xe2\x80\x9d] does not exist
Syntax OK
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# vi /etc/resolv.conf
---------------------------------------------------------------------------------------

      1 # Generated by NetworkManager
      2 search co.jp
      3 #nameserver 192.168.3.1
      4 nameserver 192.168.3.12

--------------------------------------------------------------------------------------
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# vi /etc/nsswitch.conf
--------------------------------------------------------------------------------------

     36 passwd:     files sss
     37 shadow:     files sss
     38 group:      files sss
     39 #initgroups: files sss
     40 
     41 #hosts:     db files nisplus nis dns
     42 hosts:      files dns myhostname
     43 
     44 # Example - obey only what nisplus tells us...

--------------------------------------------------------------------------------------
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# ssh root@192.168.3.12
root@192.168.3.12's password: 
Last login: Sun Mar 12 18:31:39 2023 from deploy
[root@squid ~]# 
[root@squid ~]# named -v
BIND 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.13 (Extended Support Version) <id:7107deb>
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# vi /etc/named.conf
---------------------------------------------------------------------------------------

     12 options {
     13 #  listen-on port 53 { 127.0.0.1; 192.168.3.10; };  # NTPサーバのIPアドレス
     14 #  listen-on-v6 port 53 { ::1; };
     15    directory   "/var/named";
     16    dump-file   "/var/named/data/cache_dump.db";
     17    statistics-file "/var/named/data/named_stats.txt";
     18    memstatistics-file "/var/named/data/named_mem_stats.txt";
     19    recursing-file  "/var/named/data/named.recursing";
     20    secroots-file   "/var/named/data/named.secroots";
     21    allow-query     { localhost; 192.168.3.0/24; }; # 許可するネットワークアドレス
     22    forwarders      { 8.8.8.8; }; # 再帰問い合わせ先を指定
     23 
     24    /*
     25     - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
     26     - If you are building a RECURSIVE (caching) DNS server, you need to enable
     27       recursion.
     28     - If your recursive DNS server has a public IP address, you MUST enable access
     29       control to limit queries to your legitimate users. Failing to do so will
     30       cause your server to become part of large scale DNS amplification
     31       attacks. Implementing BCP38 within your network would greatly
     32       reduce such attack surface
     33    */
     34    recursion yes; # 再帰問い合わせの許可

---------------------------------------------------------------------------------------
[root@squid ~]# named-checkconf
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources: 
  services: dhcpv6-client dns ssh
  ports: 53/tcp 53/udp
  protocols: 
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 
	
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# systemctl status named
● named.service - Berkeley Internet Name Domain (DNS)
   Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; vendor preset: disabled)
   Active: active (running) since 日 2023-03-12 18:03:47 JST; 1h 1min ago
  Process: 1757 ExecReload=/bin/sh -c /usr/sbin/rndc reload > /dev/null 2>&1 || /bin/kill -HUP $MAINPID (code=exited, status=0/SUCCESS)
 Main PID: 1627 (named)
   CGroup: /system.slice/named.service
           └─1627 /usr/sbin/named -u named -c /etc/named.conf

 3月 12 18:35:01 squid named[1627]: automatic empty zone: HOME.ARPA
 3月 12 18:35:01 squid named[1627]: none:104: 'max-cache-size 90%' - setting to 4147MB (out of 4608MB)
 3月 12 18:35:01 squid named[1627]: configuring command channel from '/etc/rndc.key'
 3月 12 18:35:01 squid named[1627]: configuring command channel from '/etc/rndc.key'
 3月 12 18:35:01 squid named[1627]: reloading configuration succeeded
 3月 12 18:35:01 squid named[1627]: reloading zones succeeded
 3月 12 18:35:01 squid named[1627]: all zones loaded
 3月 12 18:35:01 squid named[1627]: running
 3月 12 18:35:01 squid systemd[1]: Reloaded Berkeley Internet Name Domain (DNS).
 3月 12 18:35:01 squid named[1627]: managed-keys-zone: Key 20326 for zone . acceptance timer complete: ...usted
Hint: Some lines were ellipsized, use -l to show in full.
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# ps -aux | grep named
named     1627  0.0  2.2 382860 107844 ?       Ssl  18:03   0:00 /usr/sbin/named -u named -c /etc/named.conf
root      4462  0.0  0.0 112824   972 pts/0    R+   19:05   0:00 grep --color=auto named
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# 
[root@squid ~]# vi /etc/hosts
---------------------------------------------------------------------------------------

      1 127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
      2 ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
      3 192.168.3.10   honban
      4 192.168.3.11   hogehoge.co.jp deploy

---------------------------------------------------------------------------------------
[root@squid ~]# host hogehoge.co.jp
hogehoge.co.jp has address 162.43.116.58
hogehoge.co.jp mail is handled by 0 hogehoge.co.jp.
[root@squid ~]# 
[root@squid ~]# exit
ログアウト
Connection to 192.168.3.12 closed.
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# 
[root@deploy ~]# nslookup hogehoge.co.jp
Server:		192.168.3.12
Address:	192.168.3.12#53

Non-authoritative answer:
Name:	hogehoge.co.jp
Address: 162.43.116.58

[root@deploy ~]#
